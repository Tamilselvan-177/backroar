{% extends "base.twig" %}

{% block title %}Edit Product{% endblock %}

{% block content %}
<section class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">Edit Product</h1>
        <a href="{{ app_url }}/admin/products/{{ product.id }}/images" class="bg-gray-800 text-white px-4 py-2 rounded">Manage Images</a>
    </div>
    <form action="{{ app_url }}/admin/products/{{ product.id }}" method="post" class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 rounded shadow">
        <input type="hidden" name="_token" value="{{ csrf_token }}">
        <div>
            <label class="block font-semibold mb-2">Name</label>
            <input type="text" name="name" value="{{ old.name ?? product.name }}" class="border p-2 w-full" />
        </div>
        <div>
            <label class="block font-semibold mb-2">Slug</label>
            <input type="text" name="slug" value="{{ old.slug ?? product.slug }}" class="border p-2 w-full" />
        </div>
        <div>
            <label class="block font-semibold mb-2">Category</label>
            <select name="category_id" class="border p-2 w-full">
                {% for c in categories %}
                <option value="{{ c.id }}" {% if c.id == product.category_id %}selected{% endif %}>{{ c.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block font-semibold mb-2">Brand</label>
            <select name="brand_id" class="border p-2 w-full">
                <option value="">Select</option>
                {% for b in brands %}
                <option value="{{ b.id }}" {% if b.id == product.brand_id %}selected{% endif %}>{{ b.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block font-semibold mb-2">Subcategory</label>
            <select name="subcategory_id" id="subcategory" class="border p-2 w-full">
                <option value="">Select</option>
                {% for s in subcategories %}
                <option value="{{ s.id }}" {% if s.id == product.subcategory_id %}selected{% endif %}>{{ s.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block font-semibold mb-2">Model</label>
            <select name="model_id" id="model" class="border p-2 w-full">
                <option value="">Select</option>
                {% for m in models %}
                <option value="{{ m.id }}" {% if m.id == product.model_id %}selected{% endif %}>{{ m.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block font-semibold mb-2">Price</label>
            <input type="number" step="0.01" name="price" value="{{ old.price ?? product.price }}" class="border p-2 w-full" />
        </div>
        <div>
            <label class="block font-semibold mb-2">Sale Price</label>
            <input type="number" step="0.01" name="sale_price" value="{{ old.sale_price ?? product.sale_price }}" class="border p-2 w-full" />
        </div>
        <div>
            <label class="block font-semibold mb-2">Stock Quantity</label>
            <input type="number" name="stock_quantity" value="{{ old.stock_quantity ?? product.stock_quantity }}" class="border p-2 w-full" />
        </div>
        <div class="flex items-center space-x-4">
            <label class="flex items-center space-x-2"><input type="checkbox" name="is_active" {% if product.is_active %}checked{% endif %}><span>Active</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" name="is_featured" {% if product.is_featured %}checked{% endif %}><span>Featured</span></label>
        </div>
        <div class="md:col-span-2">
            <label class="block font-semibold mb-2">Description</label>
            <textarea name="description" class="border p-2 w-full" rows="4">{{ old.description ?? product.description }}</textarea>
        </div>
        <div class="md:col-span-2 flex justify-end">
            <button class="bg-black text-white px-4 py-2 rounded">Save Changes</button>
        </div>
    </form>
    {% block scripts %}
    <script>
    const catSel = document.querySelector('select[name="category_id"]');
    const brandSel = document.querySelector('select[name="brand_id"]');
    const subSel = document.getElementById('subcategory');
    const modelSel = document.getElementById('model');
    async function loadSubcategories(cid){
        subSel.innerHTML = '<option value="">Select</option>';
        if(!cid) return;
        const res = await fetch('{{ app_url }}/admin/ajax/subcategories/'+cid);
        const data = await res.json();
        data.forEach(s=>{
            const opt=document.createElement('option');
            opt.value=s.id;opt.textContent=s.name;subSel.appendChild(opt);
        });
    }
    async function loadModels(bid){
        modelSel.innerHTML = '<option value="">Select</option>';
        if(!bid) return;
        const res = await fetch('{{ app_url }}/admin/ajax/models/'+bid);
        const data = await res.json();
        data.forEach(m=>{
            const opt=document.createElement('option');
            opt.value=m.id;opt.textContent=m.name;modelSel.appendChild(opt);
        });
    }
    catSel.addEventListener('change', e=>loadSubcategories(e.target.value));
    brandSel.addEventListener('change', e=>loadModels(e.target.value));
    </script>
    {% endblock %}
</section>
{% endblock %}
